<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<!-- This is a Thymeleaf fragment -->
<div th:fragment="product-table">

    <!-- Success/Error Messages -->
    <div th:if="${success}" class="alert alert-success">
        <i class="fas fa-check-circle"></i>
        <span th:text="${success}"></span>
    </div>

    <div th:if="${error}" class="alert alert-error">
        <i class="fas fa-exclamation-triangle"></i>
        <span th:text="${error}"></span>
    </div>

    <!-- Add Product Form -->
    <div class="form-section">
        <h3><i class="fas fa-plus"></i> Add New Product</h3>
        <form hx-post="/products" hx-target="#product-table-container" hx-indicator="#add-loading">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--wa-spacing-md);">
                <div class="form-group">
                    <label class="form-label" for="title">Product Title *</label>
                    <input type="text" id="title" name="title" class="form-control" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="price">Price *</label>
                    <input type="number" id="price" name="price" step="0.01" class="form-control" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="handle">Handle *</label>
                    <input type="text" id="handle" name="handle" class="form-control" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="vendor">Vendor</label>
                    <input type="text" id="vendor" name="vendor" class="form-control">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="productType">Product Type</label>
                <input type="text" id="productType" name="productType" class="form-control">
            </div>

            <button type="submit" class="btn btn-success">
                <i class="fas fa-plus"></i>
                Add Product
                <span id="add-loading" class="htmx-indicator">
                        <i class="fas fa-spinner fa-spin"></i>
                    </span>
            </button>
        </form>
    </div>

    <!-- Products Table -->
    <div th:if="${products != null and !products.empty}">
        <h3><i class="fas fa-table"></i> Products (<span th:text="${products.size()}"></span>)</h3>

        <table style="width: 100%; border-collapse: collapse; margin-top: var(--wa-spacing-md);">
            <thead>
            <tr style="background-color: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                <th style="padding: var(--wa-spacing-md); text-align: left; font-weight: 600;">Title</th>
                <th style="padding: var(--wa-spacing-md); text-align: left; font-weight: 600;">Price</th>
                <th style="padding: var(--wa-spacing-md); text-align: left; font-weight: 600;">Handle</th>
                <th style="padding: var(--wa-spacing-md); text-align: left; font-weight: 600;">Vendor</th>
                <th style="padding: var(--wa-spacing-md); text-align: left; font-weight: 600;">Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="product : ${products}"
                style="border-bottom: 1px solid #dee2e6;"
                th:style="'background-color: ' + (${productStat.odd} ? '#ffffff' : '#f8f9fa')">

                <td style="padding: var(--wa-spacing-md);">
                    <strong th:text="${product.title}"></strong>
                    <div th:if="${product.productType}"
                         style="font-size: var(--wa-font-size-sm); color: #6c757d;"
                         th:text="${product.productType}">
                    </div>
                </td>

                <td style="padding: var(--wa-spacing-md); font-weight: 500; color: var(--wa-color-success);">
                    $<span th:text="${#numbers.formatDecimal(product.price, 1, 2)}"></span>
                </td>

                <td style="padding: var(--wa-spacing-md); font-family: monospace; background-color: #f8f9fa; border-radius: 4px;">
                    <span th:text="${product.handle}"></span>
                </td>

                <td style="padding: var(--wa-spacing-md);">
                            <span th:text="${product.vendor ?: 'N/A'}"
                                  th:class="${product.vendor} ? '' : 'text-muted'"></span>
                </td>

                <td style="padding: var(--wa-spacing-md);">
                    <div style="display: flex; gap: var(--wa-spacing-xs);">
                        <a th:href="@{/products/{id}/edit(id=${product.id})}"
                           class="btn btn-primary"
                           style="font-size: var(--wa-font-size-sm); padding: var(--wa-spacing-xs) var(--wa-spacing-sm);">
                            <i class="fas fa-edit"></i>
                            Edit
                        </a>

                        <button
                                th:hx-delete="@{/products/{id}(id=${product.id})}"
                                hx-target="#product-table-container"
                                hx-confirm="Are you sure you want to delete this product?"
                                class="btn btn-danger"
                                style="font-size: var(--wa-font-size-sm); padding: var(--wa-spacing-xs) var(--wa-spacing-sm);">
                            <i class="fas fa-trash"></i>
                            Delete
                        </button>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div th:if="${products == null or products.empty}" class="loading">
        <i class="fas fa-inbox"></i>
        No products found. The scheduled job will automatically fetch products from Famme API.
    </div>
</div>
</body>
</html>